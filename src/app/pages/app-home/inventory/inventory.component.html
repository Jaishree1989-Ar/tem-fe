<section class="overall-inventory">
    <div class="header row align-items-center">
        <div class="col">
            <header class="headerText">Inventory</header>
        </div>
        <div class="col"></div>
    </div>
    <div class="p-3">
        <mat-tab-group class="custom-tabs" mat-stretch-tabs="false" mat-align-tabs="start"
            (selectedTabChange)="onTabChange($event)">
            <mat-tab label="FirstNet"></mat-tab>
            <mat-tab label="AT&T Mobility"></mat-tab>
            <mat-tab label="Verizon"></mat-tab>
        </mat-tab-group>

        <div class="mt-3">
            <div class="d-flex filter-sec">
                <form [formGroup]="filterForm" class="d-flex gap-3 ">
                    <mat-form-field appearance="outline">
                        <mat-label>Department</mat-label>
                        <mat-select formControlName="departments" multiple>
                            <mat-option [value]="'selectAll'" (onSelectionChange)="toggleSelectAll($event)"
                                class="select-all-option">
                                Select All
                            </mat-option>
                            <mat-option *ngFor="let option of distinctDepts" [value]="option">
                                {{ option }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field appearance="outline">
                        <mat-label>Month and Year</mat-label>
                        <input matInput [matDatepicker]="picker" formControlName="monthYear" [max]="maxDate" readonly>
                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker #picker startView="multi-year" (monthSelected)="monthSelected($event, picker)"
                            panelClass="month-year-picker">
                        </mat-datepicker>
                    </mat-form-field>
                    <div class="d-flex justify-content-center pt-1">
                        <button mat-stroked-button class="ms-2" [disabled]="!isAnyFieldSelected()"
                            (click)="resetFilters()">Refresh</button>
                        <button mat-raised-button color="accent" class="ms-2" [disabled]="!isAnyFieldSelected()"
                            (click)="filterClicked()">Filter</button>
                    </div>
                </form>
            </div>
            <div class="d-flex">
                <app-filter-input placeholder="Search Reports" [(value)]="filterValue" #input
                    (valueChanged)="applyFilter($event)"></app-filter-input>
            </div>
            <div class="table-responsive">
                <table mat-table [dataSource]="dataSource" multiTemplateDataRows matSort class="mat-elevation-z8">
                    @for (column of displayedColumns; track column) {
                    <ng-container matColumnDef="{{column}}">
                        <th mat-header-cell mat-sort-header *matHeaderCellDef>
                            {{ column === 'department' ? 'Department/Division' : (column | camelCaseToTitlePipe) }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{element[column]}}
                        </td>
                    </ng-container>
                    }
                    <ng-container matColumnDef="expand">
                        <th mat-header-cell *matHeaderCellDef aria-label="row actions"> </th>
                        <td mat-cell *matCellDef="let element">
                            <div class="d-flex actions-btns">
                                <div class="expand-btn">
                                    <button mat-icon-button aria-label="expand row"
                                        [matTooltip]="expandedElement === element ? 'Collapse' : 'Expand' "
                                        (click)="(expandedElement = expandedElement === element ? null : element); $event.stopPropagation()">
                                        @if (expandedElement === element) {
                                        <mat-icon>keyboard_arrow_up</mat-icon>
                                        } @else {
                                        <mat-icon>keyboard_arrow_down</mat-icon>
                                        }
                                    </button>
                                </div>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="expandedDetail">
                        <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplayWithExpand.length">
                            <div class="example-element-detail"
                                [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                                <div class="kv-container my-3">
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="kv-row" *ngFor="let column of overallColumnArr1">
                                                <div class="col-5">
                                                    @if (column === 'udl2') {
                                                    <span>Viscode</span>
                                                    } @else if (column === 'udl4') {
                                                    <span>MDA</span>
                                                    } @else {
                                                    <span>{{ column | camelCaseToTitlePipe }}</span>
                                                    }
                                                </div>
                                                <div class="col-1">: </div>
                                                <div class="col-6">{{ element[column] == null ? "-" :
                                                    element[column] }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="kv-row" *ngFor="let column of overallColumnArr2">
                                                <div class="col-5">{{column | camelCaseToTitlePipe}} </div>
                                                <div class="col-1">: </div>
                                                <div class="col-6">{{ element[column] == null ? "-" :
                                                    element[column] }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
                    <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand;"
                        class="example-element-row" [class.example-expanded-row]="expandedElement === element">
                    </tr>
                    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row">
                    </tr>

                    <tr class="mat-row no-data" *matNoDataRow>
                        <td class="mat-cell text-center py-3" *ngIf="this.dataSource.data.length!= 0"
                            [attr.colspan]="displayedColumns.length + 1">
                            No data matching
                            the search criteria.
                            <span> "{{input.value}}"</span>.
                        </td>
                        <td class="mat-cell text-center py-3" *ngIf="this.dataSource.data.length=== 0"
                            [attr.colspan]="displayedColumns.length + 1">
                            No data available.
                        </td>
                    </tr>
                </table>
                <mat-paginator [length]="totalElements" [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 100]"
                    aria-label="Select page of inventories">
                </mat-paginator>
            </div>
        </div>
    </div>
</section>